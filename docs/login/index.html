<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>FAFO Login</title>

    <!-- Pixel-ish fallback stack (we can swap to a real pixel font later if you want) -->
    <style>
      :root{
        --win-bg: #008080;          /* classic teal desktop */
        --win-face: #c0c0c0;        /* window grey */
        --win-shadow: #808080;      /* dark bevel */
        --win-highlight: #ffffff;   /* light bevel */
        --win-text: #000;
        --win-blue: #000080;        /* title bar blue */
      }

      html, body { height: 100%; }
      body{
        margin:0;
        background: var(--win-bg);
        font-family: "MS Sans Serif", Tahoma, Verdana, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
        color: var(--win-text);
        display:flex;
        align-items:center;
        justify-content:center;
        padding: 24px;
      }

      /* Window frame */
      .window{
        width: min(520px, 92vw);
        background: var(--win-face);
        border: 2px solid var(--win-shadow);
        box-shadow:
          0 0 0 2px var(--win-highlight) inset,
          0 0 0 4px var(--win-face) inset;
      }

      /* Title bar */
      .titlebar{
        background: var(--win-blue);
        color: #fff;
        padding: 6px 8px;
        display:flex;
        align-items:center;
        justify-content:space-between;
        font-weight: 700;
        letter-spacing: 0.2px;
        user-select:none;
      }

      .titlebar .controls{
        display:flex; gap:4px;
      }

      .btn{
        width: 18px;
        height: 18px;
        background: var(--win-face);
        border: 2px solid var(--win-shadow);
        box-shadow: 0 0 0 2px var(--win-highlight) inset;
      }

      .content{
        padding: 16px;
      }

      .logo-wrap{
        display:flex;
        gap: 12px;
        align-items:center;
        margin-bottom: 12px;
      }

      .logo{
        width: 80px;
        height: auto;
        image-rendering: pixelated;
      }

      h1{
        font-size: 18px;
        margin: 0 0 2px 0;
      }
      .hint{
        margin: 0;
        font-size: 13px;
        color: #111;
        opacity: 0.85;
      }

      label{
        display:block;
        margin-top: 12px;
        font-size: 13px;
      }

      input{
        width: 100%;
        padding: 10px 10px;
        font-size: 14px;
        margin-top: 6px;
        background: #fff;
        border: 2px solid #000;
        box-shadow:
          1px 1px 0 0 var(--win-highlight) inset,
          -1px -1px 0 0 var(--win-shadow) inset;
      }

      .row{
        display:flex;
        gap: 10px;
        align-items:center;
        margin-top: 12px;
      }

      button{
        flex: 1;
        padding: 10px;
        font-size: 14px;
        background: var(--win-face);
        border: 2px solid var(--win-shadow);
        box-shadow: 0 0 0 2px var(--win-highlight) inset;
        cursor: pointer;
      }
      button:active{
        box-shadow: 0 0 0 2px var(--win-shadow) inset;
        transform: translateY(1px);
      }

      #msg{
        margin: 10px 0 0 0;
        font-size: 13px;
        min-height: 18px;
      }
      .ok{ color: #0a7a0a; }
      .err{ color: #b00020; }

      .footer{
        margin-top: 14px;
        font-size: 12px;
        opacity: 0.8;
      }

      a{ color: #0000ee; }
    </style>
  </head>

  <body>
    <div class="window">
      <div class="titlebar">
        <div>Fork About and Find Out</div>
        <div class="controls" aria-hidden="true">
          <div class="btn"></div>
          <div class="btn"></div>
          <div class="btn"></div>
        </div>
      </div>

      <div class="content">
        <div class="logo-wrap">
          <!-- ✅ change the src if your filename/path differs -->
          <img class="logo" src="/assets/fafo-logo.png" alt="FAFO logo" />
          <div>
            <h1>Sign in</h1>
            <p class="hint">We’ll email you a one-time sign-in link.</p>
          </div>
        </div>

        <form id="f">
          <label for="email">Email address</label>
          <input id="email" type="email" placeholder="you@domain.com" required autocomplete="email" />

          <div class="row">
            <button type="submit" id="sendBtn">Send sign-in link</button>
          </div>

          <p id="msg" class="hint"></p>
          <div class="footer">
            Having trouble? Try checking spam, or use a different email.
          </div>
        </form>
      </div>
    </div>

    <script type="module">
      const f = document.getElementById("f");
      const emailEl = document.getElementById("email");
      const msg = document.getElementById("msg");
      const sendBtn = document.getElementById("sendBtn");

      function setMsg(text, cls) {
        msg.textContent = text;
        msg.className = cls ? cls : "hint";
      }

      f.addEventListener("submit", async (e) => {
        e.preventDefault();
        const email = emailEl.value.trim();

        sendBtn.disabled = true;
        setMsg("Sending sign-in link…", "hint");

        try {
          const res = await fetch("/api/send-otp", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email }),
          });

          if (!res.ok) {
            const t = await res.text();
            setMsg(t || "Something went wrong sending the email.", "err");
            return;
          }

          setMsg("✅ Check your email for the sign-in link.", "ok");
          emailEl.blur();
        } catch (err) {
          setMsg("Network error. Try again or switch network/VPN.", "err");
        } finally {
          sendBtn.disabled = false;
        }
      });
    </script>
  </body>
</html>
