<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Fork About &amp; Find Out ‚Äî Access</title>

    <style>
      :root{
        --w98-bg: #008080;          /* Win98 teal desktop */
        --w98-face: #c0c0c0;        /* window face */
        --w98-shadow: #808080;      /* dark bevel */
        --w98-hilite: #ffffff;      /* light bevel */
        --w98-text: #000000;
        --w98-title: #000080;       /* titlebar navy */
        --w98-title-text: #ffffff;
      }

      html, body { height: 100%; }

      /* Desktop background */
      body{
        margin: 0;
        background: var(--w98-bg);
        color: var(--w98-text);
        font-family: "MS Sans Serif", Tahoma, Verdana, Arial, sans-serif;
        -webkit-font-smoothing: none;
        -moz-osx-font-smoothing: auto;
        text-rendering: geometricPrecision;
      }

      .wrap{
        min-height: 100%;
        display: grid;
        place-items: center;
        padding: 40px 16px;
      }

      /* Win98 window */
      .window{
        width: min(600px, 100%);
        background: var(--w98-face);
        border: 2px solid var(--w98-hilite);
        box-shadow:
          inset -2px -2px 0 var(--w98-shadow),
          inset  2px  2px 0 var(--w98-hilite),
          2px 2px 0 #000;
        background-image: linear-gradient(rgba(0,0,0,0.02), rgba(0,0,0,0.02));
      }

      /* Title bar */
      .titlebar{
        background: var(--w98-title);
        color: var(--w98-title-text);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 6px 8px;
        font-weight: 700;
        user-select: none;
      }

      .titlebar-left{
        display: flex;
        align-items: center;
        gap: 8px;
        min-width: 0;
      }

      .titlebar-left .title{
        font-size: 13px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .titlebar-controls{
        display: flex;
        gap: 6px;
      }

      .ctrl{
        width: 18px;
        height: 18px;
        background: var(--w98-face);
        border: 2px solid var(--w98-hilite);
        box-shadow:
          inset -2px -2px 0 var(--w98-shadow),
          inset  2px  2px 0 var(--w98-hilite);
      }

      /* Window body */
      .content{
        padding: 14px 16px 16px;
      }

      .header{
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 12px;
      }

      .spin-logo{
        width: 80px;
        height: 80px;
        border-radius: 6px;
        background: var(--w98-face);
        object-fit: cover;
        border: 2px solid var(--w98-hilite);
        box-shadow:
          inset -2px -2px 0 var(--w98-shadow),
          inset  2px  2px 0 var(--w98-hilite);
      }

      .logo{
        width: 56px;
        height: 56px;
        border-radius: 8px;
        background: #fff;
        object-fit: cover;
        image-rendering: pixelated;
        border: 2px solid var(--w98-hilite);
        box-shadow:
          inset -2px -2px 0 var(--w98-shadow),
          inset  2px  2px 0 var(--w98-hilite);
      }

      h1{
        margin: 0;
        font-size: 20px;
        font-weight: 700;
      }

      /* Form */
      form{ margin: 0; }

      label{
        display: block;
        font-size: 13px;
        margin: 12px 0 6px;
      }

      input[type="text"],
      input[type="email"]{
        width: 100%;
        box-sizing: border-box;
        padding: 10px;
        font-size: 14px;
        background: #ffffff;
        border: 2px solid #000;
        box-shadow:
          inset 2px 2px 0 var(--w98-shadow),
          inset -2px -2px 0 var(--w98-hilite);
      }

      .fineprint{
        font-size: 12px;
        line-height: 1.35;
        margin: 10px 0 0;
        color: #111;
      }

      .checkrow{
        display: flex;
        align-items: flex-start;
        gap: 10px;
        margin-top: 12px;
        font-size: 13px;
      }

      .checkrow input[type="checkbox"]{
        width: 22px;
        height: 22px;
        margin-top: 2px;
        flex: 0 0 auto;
        background: #fff;
        border: 2px solid #000;
        box-shadow:
          inset 2px 2px 0 var(--w98-shadow),
          inset -2px -2px 0 var(--w98-hilite);
      }

      .checkrow label{
        margin: 0;
        font-size: 14px;
        line-height: 1.3;
        color: #ffffff;
        text-shadow:
          -1px -1px 0 #000000,
          1px -1px 0 #000000,
          -1px 1px 0 #000000,
          1px 1px 0 #000000;
        cursor: pointer;
        user-select: none;
      }

        button{
      width: 100%;
      box-sizing: border-box;
    
      /* move it down */
      margin-top: 22px;
    
      /* make it bigger */
      padding: 14px 12px;
      font-size: 16px;
    
      background: var(--w98-face);
      border: 2px solid var(--w98-hilite);
      box-shadow:
        inset -2px -2px 0 var(--w98-shadow),
        inset  2px  2px 0 var(--w98-hilite);
      cursor: pointer;
    }

      button:active{
        box-shadow:
          inset 2px 2px 0 var(--w98-shadow),
          inset -2px -2px 0 var(--w98-hilite);
      }

      button:disabled{
        opacity: 0.65;
        cursor: not-allowed;
      }

      #msg{
        margin: 10px 0 0;
        min-height: 18px;
        overflow: visible;
        padding: 0;
        font-size: 13px;
      }
      .err{ color: #b00020; }
      .ok{ color: #0a7a0a; }
    </style>
  </head>

  <body>
    <div class="wrap">
      <div class="window" role="dialog" aria-label="FAFO Access">
        <div class="titlebar">
          <div class="titlebar-left">
            <div class="title">Fork About &amp; Find Out</div>
          </div>
          <div class="titlebar-controls" aria-hidden="true">
            <div class="ctrl" title="Minimize"></div>
            <div class="ctrl" title="Maximize"></div>
            <div class="ctrl" title="Close"></div>
          </div>
        </div>

        <div class="content">
          <div class="header">
            <video
              class="spin-logo"
              autoplay
              loop
              muted
              playsinline
              aria-label="FAFO spinning logo"
            >
              <source src="/assets/fafo-spin.webm" type="video/webm" />
              <source src="/assets/fafo-spin.mp4" type="video/mp4" />
            </video>
            <h1>Get access</h1>
          </div>

          <form id="f">
            <label for="name">Name</label>
            <input
              id="name"
              name="name"
              type="text"
              placeholder="Ada Lovelace"
              autocomplete="name"
              required
            />

            <label for="email">Email</label>
            <input
              id="email"
              name="email"
              type="email"
              placeholder="you@domain.com"
              autocomplete="email"
              required
            />

            <div class="checkrow">
              <input id="updates" name="updates" type="checkbox" />
              <label for="updates">
                sign up to join the FAFO mailing list üç¥
              </label>
            </div>

            <button id="btn" type="submit">Continue</button>

            <p id="msg" class="hint" aria-live="polite"></p>
          </form>
        </div>
      </div>
    </div>

    <script>
      const f = document.getElementById("f");
      const nameEl = document.getElementById("name");
      const emailEl = document.getElementById("email");
      const updatesEl = document.getElementById("updates");
      const msg = document.getElementById("msg");
      const btn = document.getElementById("btn");

      const params = new URLSearchParams(window.location.search);
      const next = params.get("next") || "/";

      function setMsg(text, type) {
        msg.textContent = text || "";
        msg.className = type ? type : "hint";
      }

      f.addEventListener("submit", async (e) => {
        e.preventDefault();
        setMsg("Saving‚Ä¶", "hint");
        btn.disabled = true;

        const controller = new AbortController();
        const timeout = setTimeout(() => controller.abort(), 12000);

        try {
          const payload = {
            name: nameEl.value.trim(),
            email: emailEl.value.trim(),
            marketing_opt_in: !!updatesEl?.checked,
            consent_version: "login_updates_v1",
          };

          const res = await fetch("/api/subscribe", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
            signal: controller.signal,
          });

          const data = await res.json().catch(() => ({}));

          if (!res.ok || !data.ok) {
            const err = data.error || data.details || "Something went wrong.";
            setMsg("‚ùå " + err, "err");
            return;
          }

          setMsg("‚úÖ You‚Äôre in. Redirecting‚Ä¶", "ok");
          localStorage.setItem("fafo_access", "1");
          window.location.assign(next);
        } catch (err) {
          console.error(err);
          const isAbort = err && err.name === "AbortError";
          setMsg(isAbort ? "‚ùå Request timed out. Try again." : "‚ùå Network/JS error. Check console.", "err");
        } finally {
          clearTimeout(timeout);
          btn.disabled = false;
        }
      });
    </script>
  </body>
</html>
